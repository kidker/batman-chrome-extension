// Generated by CoffeeScript 1.6.2
(function() {
  var app, _ref,
    __hasProp = {}.hasOwnProperty;

  window.BatmanDebug = (function() {
    function BatmanDebug() {}

    BatmanDebug.prototype.init = function() {
      return this.messageListener();
    };

    BatmanDebug.prototype.messageListener = function() {
      var _this = this;

      return window.addEventListener('message', function(event) {
        if (event.data["for"] === 'batman.debug') {
          return _this.handleMessage(event.data.data, function(res) {
            return window.postMessage({
              id: event.data.id,
              from: 'batman.debug',
              data: res
            }, '*');
          });
        }
      });
    };

    BatmanDebug.prototype.handleMessage = function(msg, cb) {
      switch (msg.type) {
        case 'ping':
          return cb({
            type: 'pong'
          });
        case 'storageAdapter':
          return this.storageAdapter(msg.key, msg.options, cb);
        default:
          return console.log('Unknown message', msg);
      }
    };

    BatmanDebug.prototype.storageAdapter = function(key, options, cb) {
      var action, modelName, _ref;

      _ref = key.split('::'), action = _ref[0], modelName = _ref[1];
      modelName = Batman.helpers.camelize(modelName);
      return BatmanDebug[modelName][action](options, cb);
    };

    return BatmanDebug;

  })();

  BatmanDebug.DebugController = (function() {
    function DebugController(name) {
      var instanceName;

      this.name = name;
      instanceName = this.name.substr(0, this.name.length - 'Controller'.length);
      this.instanceName = Batman.helpers.underscore(instanceName);
      this.instance = Batman.currentApp.get("controllers." + instanceName);
    }

    DebugController.prototype.isCurrentController = function() {
      return Batman.currentApp.get('currentRoute.controller') === this.instanceName;
    };

    DebugController.prototype.toJSON = function() {
      return {
        id: this.instance._batmanID(),
        name: this.name,
        action: this.instance.get('action'),
        path: this.instance.get('params.path'),
        current: this.isCurrentController()
      };
    };

    DebugController.readAll = function(options, cb) {
      var attr, controller, controllers, name, _ref;

      controllers = [];
      _ref = Batman.currentApp;
      for (name in _ref) {
        if (!__hasProp.call(_ref, name)) continue;
        attr = _ref[name];
        if (attr.prototype instanceof Batman.Controller) {
          controller = new this(name);
          controllers.push(controller.toJSON());
        }
      }
      return cb(controllers);
    };

    return DebugController;

  })();

  BatmanDebug.DebugModel = (function() {
    function DebugModel() {}

    DebugModel.readAll = function(options, cb) {
      var attr, models, name, _ref;

      models = [];
      _ref = Batman.currentApp;
      for (name in _ref) {
        if (!__hasProp.call(_ref, name)) continue;
        attr = _ref[name];
        if (attr.prototype instanceof Batman.Model) {
          models.push({
            name: name
          });
        }
      }
      return cb(models);
    };

    return DebugModel;

  })();

  BatmanDebug.DebugView = (function() {
    function DebugView() {}

    DebugView.readAll = function(options, cb) {
      var attr, name, views, _ref;

      views = [];
      _ref = Batman.currentApp;
      for (name in _ref) {
        if (!__hasProp.call(_ref, name)) continue;
        attr = _ref[name];
        if (attr.prototype instanceof Batman.Model) {
          views.push({
            name: name
          });
        }
      }
      return cb(views);
    };

    return DebugView;

  })();

  if ((_ref = window.Batman) != null ? _ref.currentApp : void 0) {
    app = window.Batman.currentApp;
    app.debug = new BatmanDebug();
    app.debug.init();
  }

}).call(this);
